!function($,e,t,n){"use strict";$(t).ready(function(){function e(){return P=W.isDST?"EDT":"EST"}function t(t,n){var a=moment(),i=moment.tz(J,"America/New_York").format(t);e();var o=i;return n&&(o+=" "+P),o}function n(){$.getJSON("./results.json",function(e){var t="";$.each(e.info,function(e,n){n.startDate=n.startDate.slice(0,-4)+n.startDate.slice(8),(n.endDate||""!==n.endTime)&&(n.endDate=n.endDate.slice(0,-4)+n.endDate.slice(8),n.startTime=n.startTime.slice(0,-4)),t+="<p>"+n.startDate+" ",t+=n.startTime+" ",""!==n.endDate&&(t+="to "+n.endDate),""!==n.endTime&&(t+=" "+n.endTime+" "),t+=n.message+"</p>"}),$("#currentMessage").hide().html(t).fadeIn(300)})}function a(){if(5==$("input[name=empId]").val().length){$("input").each(function(e){"empId"!==$(this).attr("name")&&$(this).val("")}),$("textarea").val(""),$(x).each(function(e){w()}),$("input[name=startDate]").val("1/1/2000"),$("input[name=startTime]").val("1100"),$("textarea").val("All Systems are Clear");var e=$("#msgForm"),n=$("input[name=empId]").val(),a={},i=t("MM/DD/YY HH:mm",!0);$.each(Q.regular,function(e,t){return F===t?a.dateWarn="true":a.dateWarn="false"}),a.timestamp=i,a.msgId=n,a.info=[];var o={};o.startDate=t("MM/DD/YYYY"),o.startTime=t("HHmm"),o.endDate="",o.endTime="",o.message="All Systems Clear",a.info.push(o),$.each(a.info,function(e,t){t.startTime+=" "+P}),console.log(a);var c=JSON.stringify(a);console.log(c),$.ajax({url:"endpoint.php",data:{data:c},dataType:"json",type:"POST"}).done(function(e){console.log("success"),j(),s(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})}else $("input[name=empId]").hasClass("bad")||$("input[name=empId]").addClass("bad")}function i(){var e=$("#msgForm"),n=$("input[name=empId]").val(),a={},i=t("MM/DD/YY HH:mm",!0);if($.each(Q.regular,function(e,t){return F===t?a.dateWarn="true":a.dateWarn="false"}),a.timestamp=i,a.msgId=n,a.info=$(".form-duplicate-this").serializeObject(),$.each(a.info,function(e,t){t.startTime+=" "+P,""!==t.endTime&&(t.endTime+=" "+P)}),O(a),z){console.log(a);var o=JSON.stringify(a);console.log(o),$.ajax({url:"endpoint.php",data:{data:o},dataType:"json",type:"POST"}).done(function(e){console.log("success"),j(),s(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})}}function o(){var e=$("input[name=empId]").val(),n={},a=t("MM/DD/YY HH:mm",!0);$.each(Q.regular,function(e,t){return F===t?n.dateWarn="true":n.dateWarn="false"}),n.timestamp=a,n.msgId=e,n.info=$(".form-duplicate-this").serializeObject(),$.each(n.info,function(e,t){t.startTime+=" "+P,""!==t.endTime&&(t.endTime+=" "+P)}),O(n),z&&($.getJSON("results.json",function(e){var t=e.info,a=n.info,i=t.concat(a);n.info=i}),setTimeout(function(){console.log(n);var e=JSON.stringify(n);console.log(e),$.ajax({url:"endpoint.php",data:{data:e},dataType:"json",type:"POST"}).done(function(e){console.log("success"),j(),s(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})},1e3))}function s(){setTimeout(function(){n(),S()},2e3)}function r(e){setTimeout(function(){e&&e.fadeOut(2e3)},3e3),c(e)}function c(e){e.click(function(){$(this).stop().fadeOut(200)})}function d(){var e=!1,t=$("textarea");$.each(t,function(t,n){n.value.length<=0&&(e=!0)}),e?(l(),h(),N=!1):(u(),p(),N=!0)}function u(){k($(".add-more-messages"))}function l(){y($(".add-more-messages"))}function m(){k($(".remove-last-message"))}function f(){y($(".remove-last-message"))}function p(){k($("#submit"))}function h(){y($("#submit"))}function v(){k($("#appendMsg"))}function g(){y($("#appendMsg"))}function D(){k($("#allClear"))}function T(){y($("#allClear"))}function k(e){e.removeClass("disabled")}function y(e){e.hasClass("disabled")||e.addClass("disabled")}function Y(){if(N){var e=$(x),t=0;e.first().off().clone().appendTo(e.parent()).find(".dtpicker").attr("id","").removeClass("hasDatepicker").datepicker(),t=$("textarea").length,$.each($(x),function(e,n){if(e==t-1){var a=$(n).find("textarea");a.val("").attr("placeholder","e.g. All Enterprise Systems and applications are operational."),a.on("input",d)}}),b(),l(),h(),g(),N=!1,m()}}function w(){var e=$(x).length,t=$(x+":last");if(e>1)return t.remove(),e--,void(e<=1&&(f(),d()))}function b(){$("input[name=empId]").on("keydown",C),$("input[name=startDate]").on("keydown",function(e){9!=e.which&&e.preventDefault()}),$("input[name=startDate]").click(I),$("input[name=endDate]").on("keydown",function(e){9!=e.which&&e.preventDefault()}),$("input[name=endDate]").click(I),$("input[name=startTime]").on("keydown",C),$("input[name=startTime]").on("keyup",M),$("input[name=endTime]").on("keydown",C),$("input[name=endTime]").on("keyup",M),$("input[name=empId]").on("keyup",function(){5==$(this).val().length?D():T()})}function I(){var e=$(this).next();$(".ui-datepicker td").click(function(){e.fadeIn(300)})}function C(e){e.which>=65&&e.which<=90&&e.preventDefault(),e.which>=106&&e.which<=111&&e.preventDefault(),e.which>=186&&e.which<=222&&e.preventDefault()}function M(){var e=$(this).val();if(4===e.length){var t=e.slice(0,-2),n=e.slice(2);t=parseInt(t,10),n=parseInt(n,10),t>=25||n>=60?($(this).hasClass("bad")||$(this).addClass("bad"),H=!1):($(this).hasClass("bad")&&$(this).removeClass("bad"),H=!0)}return H}function O(e){var t=!1,n=!1;return 5==e.msgId.length&&(t=!0),$.each(e.info,function(e,t){return""===t.startDate||""===t.startTime||""===t.message?n=!1:void(n=!0)}),z=!!(t&&n&&H)}function S(){$.getJSON("./log.json",function(e){e=e.reverse();var t=[],n="";$.each(e,function(e,n){var a=n.msgId,i=n.timestamp;$.each(n.info,function(e,n){n.empId=a,n.timestamp=i,t.push(n)})}),$.each(t,function(e,t){t.startDate=t.startDate.slice(0,-4)+t.startDate.slice(8),(t.endDate||""!=t.endTime)&&(t.endDate=t.endDate.slice(0,-4)+t.endDate.slice(8)),n+="<tr>",n+="<td>"+t.timestamp+"</td>",n+="<td>"+t.empId+"</td>",n+="<td>"+t.startDate+"</td>",n+="<td>"+t.startTime+"</td>",n+="<td>"+t.endDate+"</td>",n+="<td>"+t.endTime+"</td>",n+="<td>"+t.message+"</td>",n+="</tr>"}),$("#return-table tbody").hide().html(n).fadeIn(300)})}function j(){$("input").val(""),$("textarea").val(""),$(x).each(function(e){w()}),z=!1,H=!1,h(),g()}$.ajaxSetup({cache:!1});var x=".form-duplicate-this",N=!1,H=!1,z=!1,A=$("form#msgForm");$(".dtpicker").datepicker(),$(".add-more-messages").on("click",Y),$(".remove-last-message").on("click",w),$("#submit").click(i),$("#allClear").click(a),$("#appendMsg").click(o),$("input[name=empId]").on("focus",function(){$(this).hasClass("bad")&&$(this).removeClass("bad")}),$("textarea[name=message]").on("input",d);var J=moment(),W=moment.tz(J,"America/New_York").format("MM/DD/YY HH:mm"),_=moment.tz(J,"America/New_York").format("M/D/YYYY"),E=moment().add(1,"days"),F=moment.tz(E,"America/New_York").format("M/D/YYYY"),P;e();var Q=function(){var e={};return $.getJSON("dates.json",function(t){e.regular=t.regular}),e}();setTimeout(function(){s()},2e3),$.fn.serializeObject=function(){var e=[];return $(this).each(function(t,n){var a={};$.each($(n).find("input"),function(e,t){var n=$(t).attr("name"),i=$(t).val();a[n]=i}),$.each($(n).find("textarea"),function(e,t){var n=$(t).attr("name"),i=$(t).val();a[n]=i}),e.push(a)}),e},b(),$(".clear").click(function(){$(this).prev().val(""),$(this).fadeOut(300)})})}(jQuery,window,document);