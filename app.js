!function($,e,t,n){"use strict";$(t).ready(function(){function e(){return U=W.isDST?"EDT":"EST"}function t(t,n){var a=moment(),i=moment.tz(a,"America/New_York").format(t);e();var s=i;return n&&(s+=" "+U),s}function n(){$.getJSON("./results.json",function(e){var t="";$.each(e.info,function(e,n){n.startDate=n.startDate.slice(0,-4)+n.startDate.slice(8),(n.endDate||""!==n.endTime)&&(n.endDate=n.endDate.slice(0,-4)+n.endDate.slice(8),n.startTime=n.startTime.slice(0,-4)),t+='<p><span style="font-size: 1.1em;">'+(e+1)+". |</span> "+n.startDate+" ",t+=n.startTime+" ",""!==n.endDate&&(t+="to "+n.endDate),""!==n.endTime&&(t+=" "+n.endTime+" "),t+=n.message+"</p>"}),$("#currentMessage").hide().html(t).fadeIn(300),$("#tstamp").hide().html(e.timestamp)})}function a(){if(5==$("input[name=empId]").val().length){$("input").each(function(e){"empId"!==$(this).attr("name")&&$(this).val("")}),$("textarea").val(""),$(z).each(function(e){w()}),$("input[name=startDate]").val("1/1/2000"),$("input[name=startTime]").val("1100"),$("textarea").val("All Systems are Clear");var e=$("#msgForm"),n=$("input[name=empId]").val(),a={},i=t("MM/DD/YY HH:mm:ss",!0);$.each(B.regular,function(e,t){return a.dateWarn=Q===t?"true":"false"}),a.timestamp=i,a.msgId=n,a.info=[];var s={};s.startDate=t("MM/DD/YYYY"),s.startTime=t("HHmm"),s.endDate="",s.endTime="",s.message="All Systems Clear",a.info.push(s),$.each(a.info,function(e,t){t.startTime+=" "+U}),console.log(a);var c=JSON.stringify(a);console.log(c),$.ajax({url:"endpoint.php",data:{data:c},dataType:"json",type:"POST"}).done(function(e){console.log("success"),J(),o(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})}else $("input[name=empId]").hasClass("bad")||$("input[name=empId]").addClass("bad")}function i(){var e=$("#msgForm"),n=$("input[name=empId]").val(),a={},i=t("MM/DD/YY HH:mm:ss",!0);if($.each(B.regular,function(e,t){return a.dateWarn=Q===t?"true":"false"}),a.timestamp=i,a.msgId=n,a.info=$(".form-duplicate-this").serializeObject(),$.each(a.info,function(e,t){t.startTime+=" "+U,""!==t.endTime&&(t.endTime+=" "+U)}),N(a),_){console.log(a);var s=JSON.stringify(a);console.log(s),$.ajax({url:"endpoint.php",data:{data:s},dataType:"json",type:"POST"}).done(function(e){console.log("success"),J(),o(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})}}function s(){var e=$("input[name=empId]").val(),n={},a=t("MM/DD/YY HH:mm:ss",!0);$.each(B.regular,function(e,t){return n.dateWarn=Q===t?"true":"false"}),n.timestamp=a,n.msgId=e,n.info=$(".form-duplicate-this").serializeObject(),$.each(n.info,function(e,t){t.startTime+=" "+U,""!==t.endTime&&(t.endTime+=" "+U)}),N(n),_&&($.getJSON("results.json",function(e){var t=e.info,a=n.info,i=t.concat(a);n.info=i}),setTimeout(function(){console.log(n);var e=JSON.stringify(n);console.log(e),$.ajax({url:"endpoint.php",data:{data:e},dataType:"json",type:"POST"}).done(function(e){console.log("success"),J(),o(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})},1e3))}function o(){setTimeout(function(){n(),H()},2e3)}function r(e){setTimeout(function(){e&&e.fadeOut(2e3,function(){$(this).remove()})},3e3),c(e)}function c(e){e.click(function(){$(this).stop().fadeOut(200,function(){$(this).remove()})})}function l(){var e=!1,t=$("textarea");$.each(t,function(t,n){n.value.length<=0&&(e=!0)}),e?(m(),h(),g(),A=!1):(d(),p(),v(),A=!0)}function d(){b($(".add-more-messages"))}function m(){k($(".add-more-messages"))}function u(){b($(".remove-last-message"))}function f(){k($(".remove-last-message"))}function p(){b($("#submit"))}function h(){k($("#submit"))}function v(){b($("#appendMsg"))}function g(){k($("#appendMsg"))}function D(){b($("#allClear"))}function T(){k($("#allClear"))}function I(){b($("#removeIt"))}function y(){k($("#removeIt"))}function b(e){e.removeClass("disabled")}function k(e){e.hasClass("disabled")||e.addClass("disabled")}function C(){if(A){var e=$(z),t=0;e.first().off().clone().appendTo(e.parent()).find(".dtpicker").attr("id","").removeClass("hasDatepicker").datepicker(),t=$("textarea").length,$.each($(z),function(e,n){if(e==t-1){var a=$(n).find("textarea");$(n).find("input").val(""),a.val("").attr("placeholder","e.g. All Enterprise Systems and applications are operational."),a.on("input",l)}}),Y(),m(),h(),g(),A=!1,u()}}function w(){var e=$(z).length,t=$(z+":last");if(e>1)return t.remove(),e--,d(),void(e<=1&&(f(),p(),l()))}function Y(){$("input[name=empId]").on("keydown",O),$("input[name=startDate]").on("keydown",function(e){9!=e.which&&e.preventDefault()}),$("input[name=startDate]").click(M),$("input[name=endDate]").on("keydown",function(e){9!=e.which&&e.preventDefault()}),$("input[name=endDate]").click(M),$("input[name=startTime]").on("keydown",O),$("input[name=startTime]").on("keyup",S),$("input[name=endTime]").on("keydown",O),$("input[name=endTime]").on("keyup",S),$("input[name=empId]").on("keyup",function(){5==$(this).val().length?(D(),I()):(T(),y())}),$(".clear").click(function(){$(this).prev().val(""),$(this).fadeOut(300)})}function M(){var e=$(this).next();$(".ui-datepicker td").click(function(){e.fadeIn(300)})}function O(e){e.which>=65&&e.which<=90&&e.preventDefault(),e.which>=106&&e.which<=111&&e.preventDefault(),e.which>=186&&e.which<=222&&e.preventDefault()}function S(){var e=$(this).val();if(4===e.length){var t=e.slice(0,-2),n=e.slice(2);t=parseInt(t,10),n=parseInt(n,10),t>=24||n>=60?($(this).hasClass("bad")||$(this).addClass("bad"),P=!1):($(this).hasClass("bad")&&$(this).removeClass("bad"),P=!0)}return P}function j(e){var t={};return t.fullDate=e,t.month=t.fullDate.slice(0,-8),t.day=t.fullDate.slice(3,-5),t.year=t.fullDate.slice(6),t.number=t.year+t.month+t.day,t.int=parseInt(t.number,10),t}function N(e){function t(e){var t='<div class="error"><p>'+e+"</p></div>";$(".removeMsg").after(t),r($(".error"))}var n=!1,a=!1;return 5==e.msgId.length&&(n=!0),$.each(e.info,function(e,n){var i=j(n.startDate),s=n.startTime.slice(0,-4);if(""!==n.endDate)var o=j(n.endDate);else var o=i.int;if(""===n.startDate||""===s||""===n.message)return console.log("Missing a required field"),t("Missing a required field!"),a=!1;if(i.int>o.int)return console.log("Cannot have a start date greater than the end date!"),t("Cannot have a start date greater than the end date!"),a=!1;if(""!==n.endDate&&""===n.endTime)return console.log("Need an end time when stating an end date"),t("Need an end time when stating an end date!"),a=!1;if(""!==n.endTime)if(n.startDate===n.endDate||""===n.endDate){var r=n.startTime;r=r.slice(0,-4),r=parseInt(r,10);var c=n.endTime;if(c=c.slice(0,-4),c=parseInt(c,10),r>c)return console.log("time mismatch"),t("Cannot have a start time greater than the end time!"),a=!1;a=!0}else a=!0;else a=!0}),_=!!(n&&a&&P)}function x(){if(5===$("input[name=empId]").val().length){var e=$("#tstamp").html(),n=!1,a,i=parseInt($("input[name=removeIt]").val(),10)-1;$.getJSON("results.json",function(s){if(e===s.timestamp)s.info.length>1?($.each(s.info,function(e,t){i===e&&(s.info.splice(e,1),n=!0)}),n?(s.timestamp=t("MM/DD/YY HH:mm:ss",!0),a=JSON.stringify(s),$.ajax({url:"endpoint.php",data:{data:a},dataType:"json",type:"POST"}).done(function(e){console.log("success"),J(),o(),$(".half.two").append('<div class="good"><p>Your update has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})):$("input[name=removeIt]").hasClass("bad")||$("input[name=removeIt]").addClass("bad").val("").attr("placeholder","Invalid Number")):$("input[name=removeIt]").hasClass("bad")||$("input[name=removeIt]").addClass("bad").val("").attr("placeholder","Use All Clear");else{console.log("timestamp mismatch!");var c=confirm("Current message does not match! Click OK to reload the page with the current messages and try again.");confirm&&o()}})}else $("input[name=empId]").hasClass("bad")||$("input[name=empId]").addClass("bad")}function H(){$.getJSON("./log.json",function(e){e=e.reverse();var t=[],n="";$.each(e,function(e,n){var a=n.msgId,i=n.timestamp;$.each(n.info,function(e,n){n.empId=a,n.timestamp=i,t.push(n)})}),$.each(t,function(e,t){e<10&&(t.startDate=t.startDate.slice(0,-4)+t.startDate.slice(8),(t.endDate||""!==t.endTime)&&(t.endDate=t.endDate.slice(0,-4)+t.endDate.slice(8)),n+="<tr>",n+="<td>"+t.timestamp+"</td>",n+="<td>"+t.empId+"</td>",n+="<td>"+t.startDate+"</td>",n+="<td>"+t.startTime+"</td>",n+="<td>"+t.endDate+"</td>",n+="<td>"+t.endTime+"</td>",n+="<td>"+t.message+"</td>",n+="</tr>")}),$("#return-table tbody").hide().html(n).fadeIn(300)})}function J(){$("input").val(""),$("textarea").val(""),$(z).each(function(e){w()}),_=!1,P=!1,h(),g(),T(),$(".clear").hide()}$.ajaxSetup({cache:!1});var z=".form-duplicate-this",A=!1,P=!1,_=!1,E=$("form#msgForm");$(".dtpicker").datepicker(),$(".add-more-messages").on("click",C),$(".remove-last-message").on("click",w),$("#submit").click(i),$("#allClear").click(a),$("#appendMsg").click(s),$("input[name=empId]").on("focus",function(){$(this).hasClass("bad")&&$(this).removeClass("bad")}),$("textarea[name=message]").on("input",l);var F=moment(),W=moment.tz(F,"America/New_York").format("MM/DD/YY HH:mm"),q=moment.tz(F,"America/New_York").format("M/D/YYYY"),K=moment().add(1,"days"),Q=moment.tz(K,"America/New_York").format("M/D/YYYY"),U;e();var B=function(){var e={};return $.getJSON("dates.json",function(t){e.regular=t.regular}),e}();setTimeout(function(){o()},2e3),$.fn.serializeObject=function(){var e=[];return $(this).each(function(t,n){var a={};$.each($(n).find("input"),function(e,t){var n=$(t).attr("name"),i=$(t).val();a[n]=i}),$.each($(n).find("textarea"),function(e,t){var n=$(t).attr("name"),i=$(t).val();a[n]=i}),e.push(a)}),e},Y(),$(".clear").click(function(){$(this).prev().val(""),$(this).fadeOut(300)}),$("#removeIt").click(x),$("input[name=removeIt]").on("focus",function(){$(this).hasClass("bad")&&($(this).removeClass("bad"),$("input[name=removeIt]").attr("placeholder",""))})})}(jQuery,window,document);