!function($,e,t,a){"use strict";$(t).ready(function(){function e(){return H=C.isDST?"EDT":"EST"}function t(t,a){var n=moment(),i=moment.tz(x,"America/New_York").format(t);e();var o=i;return a&&(o+=" "+H),o}function a(){$.getJSON("./results.json",function(e){var t="";$.each(e.info,function(e,a){a.startDate=a.startDate.slice(0,-4)+a.startDate.slice(8),(a.endDate||""!==a.endTime)&&(a.endDate=a.endDate.slice(0,-4)+a.endDate.slice(8),a.startTime=a.startTime.slice(0,-4)),t+="<p>"+a.startDate+" ",t+=a.startTime+" ",""!==a.endDate&&(t+="to "+a.endDate),""!==a.endTime&&(t+=" "+a.endTime+" "),t+=a.message+"</p>"}),$("#currentMessage").hide().html(t).fadeIn(300)})}function n(){$("input").each(function(e){"empId"!=$(this).attr("name")&&$(this).val("")}),$("textarea").val(""),$(I).each(function(e){D()}),$("input[name=startDate]").val("1/1/2000"),$("input[name=startTime]").val("1100"),$("textarea").val("All Systems are Clear");var e=$("#msgForm"),a=$("input[name=empId]").val(),n={},i=t("MM/DD/YY HH:mm",!0);$.each(A.regular,function(e,t){return N===t?n.dateWarn="true":n.dateWarn="false"}),n.timestamp=i,n.msgId=a,n.info=[];var r={};r.startDate=t("MM/DD/YYYY"),r.startTime=t("HHmm"),r.endDate="",r.endTime="",r.message="All Systems Clear",n.info.push(r),$.each(n.info,function(e,t){t.startTime+=" "+H}),console.log(n);var c=JSON.stringify(n);console.log(c),$.ajax({url:"endpoint.php",data:{data:c},dataType:"json",type:"POST"}).done(function(e){console.log("success"),k(),o(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),s($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})}function i(){var e=$("#msgForm"),a=$("input[name=empId]").val(),n={},i=t("MM/DD/YY HH:mm",!0);$.each(A.regular,function(e,t){return N===t?n.dateWarn="true":n.dateWarn="false"}),n.timestamp=i,n.msgId=a,n.info=$(".form-duplicate-this").serializeObject(),$.each(n.info,function(e,t){t.startTime+=" "+H,""!==t.endTime&&(t.endTime+=" "+H)}),console.log(n);var r=JSON.stringify(n);console.log(r),$.ajax({url:"endpoint.php",data:{data:r},dataType:"json",type:"POST"}).done(function(e){console.log("success"),k(),o(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),s($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})}function o(){setTimeout(function(){a(),y()},2e3)}function s(e){setTimeout(function(){e&&e.fadeOut(2e3)},3e3),r(e)}function r(e){e.click(function(){$(this).stop().fadeOut(200)})}function c(){var e=!1,t=$("textarea");$.each(t,function(t,a){a.value.length<=0&&(e=!0)}),e?(m(),p(),S=!1):(d(),f(),S=!0)}function d(){h($(".add-more-messages"))}function m(){v($(".add-more-messages"))}function u(){h($(".remove-last-message"))}function l(){v($(".remove-last-message"))}function f(){h($("#submit"))}function p(){v($("#submit"))}function h(e){e.removeClass("disabled")}function v(e){e.hasClass("disabled")||e.addClass("disabled")}function g(){if(S){var e=$(I),t=0;e.first().off().clone().appendTo(e.parent()).find(".dtpicker").attr("id","").removeClass("hasDatepicker").datepicker(),t=$("textarea").length,$.each($(I),function(e,a){if(e==t-1){var n=$(a).find("textarea");n.val("").attr("placeholder","e.g. All Enterprise Systems and applications are operational."),n.on("input",c)}}),Y(),m(),S=!1,u()}}function D(){var e=$(I).length,t=$(I+":last");if(e>1)return t.remove(),e--,void(e<=1&&(l(),c()))}function T(e){var t=$(e.target),a=t.val(),n=$("#submit"),i=$(".form-button");5==a.length?(S=!0,n.prop("disabled",!1)):(S=!1,n.prop("disabled",!0))}function Y(){$("input").on("keydown",b),$("input[name=startDate]").on("keydown",b),$("input[name=endDate]").on("keydown",b),$("input[name=startTime]").on("keyup",w),$("input[name=endTime]").on("keyup",w)}function b(e){9===e.which&&27===e.which&&37===e.which&&39===e.which&&46===e.which||e.which>=65&&e.which<=90&&e.preventDefault()}function w(){var e=$(this).val();if(4===e.length){var t=e.slice(0,-2),a=e.slice(2);t=parseInt(t,10),a=parseInt(a,10),t>=25||a>=60?$(this).hasClass("bad")||($(this).addClass("bad"),p()):$(this).hasClass("bad")&&($(this).removeClass("bad"),f())}}function y(){$.getJSON("./log.json",function(e){e=e.reverse();var t=[],a="";$.each(e,function(e,a){var n=a.msgId,i=a.timestamp;$.each(a.info,function(e,a){a.empId=n,a.timestamp=i,t.push(a)})}),$.each(t,function(e,t){t.startDate=t.startDate.slice(0,-4)+t.startDate.slice(8),(t.endDate||""!=t.endTime)&&(t.endDate=t.endDate.slice(0,-4)+t.endDate.slice(8)),a+="<tr>",a+="<td>"+t.timestamp+"</td>",a+="<td>"+t.empId+"</td>",a+="<td>"+t.startDate+"</td>",a+="<td>"+t.startTime+"</td>",a+="<td>"+t.endDate+"</td>",a+="<td>"+t.endTime+"</td>",a+="<td>"+t.message+"</td>",a+="</tr>"}),$("#return-table tbody").hide().html(a).fadeIn(300)})}function k(){$("input").val(""),$("textarea").val(""),$(I).each(function(e){D()})}$.ajaxSetup({cache:!1});var I=".form-duplicate-this",S=!1,j=$("form#msgForm");$(".dtpicker").datepicker(),$(".add-more-messages").on("click",g),$(".remove-last-message").on("click",D),$("#submit").click(i),$("#allCear").click(n),$("textarea[name=message]").on("input",c);var x=moment(),C=moment.tz(x,"America/New_York").format("MM/DD/YY HH:mm"),M=moment.tz(x,"America/New_York").format("M/D/YYYY"),O=moment().add(1,"days"),N=moment.tz(O,"America/New_York").format("M/D/YYYY"),H;e();var A=function(){var e={};return $.getJSON("dates.json",function(t){e.regular=t.regular}),e}();setTimeout(function(){o()},2e3),$.fn.serializeObject=function(){var e=[];return $(this).each(function(t,a){var n={};$.each($(a).find("input"),function(e,t){var a=$(t).attr("name"),i=$(t).val();n[a]=i}),$.each($(a).find("textarea"),function(e,t){var a=$(t).attr("name"),i=$(t).val();n[a]=i}),e.push(n)}),e},$("input[name=empId]").on("input",function(e){T(e)}),Y()})}(jQuery,window,document);