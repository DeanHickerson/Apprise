!function($,e,t,n){"use strict";$(t).ready(function(){function e(){return F=J.isDST?"EDT":"EST"}function t(t,n){var a=moment(),i=moment.tz(A,"America/New_York").format(t);e();var o=i;return n&&(o+=" "+F),o}function n(){$.getJSON("./results.json",function(e){var t="";$.each(e.info,function(e,n){n.startDate=n.startDate.slice(0,-4)+n.startDate.slice(8),(n.endDate||""!==n.endTime)&&(n.endDate=n.endDate.slice(0,-4)+n.endDate.slice(8),n.startTime=n.startTime.slice(0,-4)),t+="<p>"+n.startDate+" ",t+=n.startTime+" ",""!==n.endDate&&(t+="to "+n.endDate),""!==n.endTime&&(t+=" "+n.endTime+" "),t+=n.message+"</p>"}),$("#currentMessage").hide().html(t).fadeIn(300)})}function a(){if(5==$("input[name=empId]").val().length){$("input").each(function(e){"empId"!==$(this).attr("name")&&$(this).val("")}),$("textarea").val(""),$(O).each(function(e){w()}),$("input[name=startDate]").val("1/1/2000"),$("input[name=startTime]").val("1100"),$("textarea").val("All Systems are Clear");var e=$("#msgForm"),n=$("input[name=empId]").val(),a={},i=t("MM/DD/YY HH:mm",!0);$.each(P.regular,function(e,t){return E===t?a.dateWarn="true":a.dateWarn="false"}),a.timestamp=i,a.msgId=n,a.info=[];var o={};o.startDate=t("MM/DD/YYYY"),o.startTime=t("HHmm"),o.endDate="",o.endTime="",o.message="All Systems Clear",a.info.push(o),$.each(a.info,function(e,t){t.startTime+=" "+F}),console.log(a);var c=JSON.stringify(a);console.log(c),$.ajax({url:"endpoint.php",data:{data:c},dataType:"json",type:"POST"}).done(function(e){console.log("success"),j(),s(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})}else $("input[name=empId]").hasClass("bad")||$("input[name=empId]").addClass("bad")}function i(){var e=$("#msgForm"),n=$("input[name=empId]").val(),a={},i=t("MM/DD/YY HH:mm",!0);if($.each(P.regular,function(e,t){return E===t?a.dateWarn="true":a.dateWarn="false"}),a.timestamp=i,a.msgId=n,a.info=$(".form-duplicate-this").serializeObject(),$.each(a.info,function(e,t){t.startTime+=" "+F,""!==t.endTime&&(t.endTime+=" "+F)}),M(a),H){console.log(a);var o=JSON.stringify(a);console.log(o),$.ajax({url:"endpoint.php",data:{data:o},dataType:"json",type:"POST"}).done(function(e){console.log("success"),j(),s(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})}}function o(){var e=$("input[name=empId]").val(),n={},a=t("MM/DD/YY HH:mm",!0);$.each(P.regular,function(e,t){return E===t?n.dateWarn="true":n.dateWarn="false"}),n.timestamp=a,n.msgId=e,n.info=$(".form-duplicate-this").serializeObject(),$.each(n.info,function(e,t){t.startTime+=" "+F,""!==t.endTime&&(t.endTime+=" "+F)}),M(n),H&&($.getJSON("results.json",function(e){var t=e.info,a=n.info,i=t.concat(a);n.info=i}),setTimeout(function(){console.log(n);var e=JSON.stringify(n);console.log(e),$.ajax({url:"endpoint.php",data:{data:e},dataType:"json",type:"POST"}).done(function(e){console.log("success"),j(),s(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})},1e3))}function s(){setTimeout(function(){n(),S()},2e3)}function r(e){setTimeout(function(){e&&e.fadeOut(2e3)},3e3),c(e)}function c(e){e.click(function(){$(this).stop().fadeOut(200)})}function d(){var e=!1,t=$("textarea");$.each(t,function(t,n){n.value.length<=0&&(e=!0)}),e?(l(),h(),x=!1):(u(),p(),x=!0)}function u(){Y($(".add-more-messages"))}function l(){y($(".add-more-messages"))}function m(){Y($(".remove-last-message"))}function f(){y($(".remove-last-message"))}function p(){Y($("#submit"))}function h(){y($("#submit"))}function g(){Y($("#appendMsg"))}function v(){y($("#appendMsg"))}function D(){Y($("#allClear"))}function T(){y($("#allClear"))}function Y(e){e.removeClass("disabled")}function y(e){e.hasClass("disabled")||e.addClass("disabled")}function b(){if(x){var e=$(O),t=0;e.first().off().clone().appendTo(e.parent()).find(".dtpicker").attr("id","").removeClass("hasDatepicker").datepicker(),t=$("textarea").length,$.each($(O),function(e,n){if(e==t-1){var a=$(n).find("textarea");a.val("").attr("placeholder","e.g. All Enterprise Systems and applications are operational."),a.on("input",d)}}),k(),l(),h(),v(),x=!1,m()}}function w(){var e=$(O).length,t=$(O+":last");if(e>1)return t.remove(),e--,void(e<=1&&(f(),d()))}function k(){$("input").on("keydown",I),$("input[name=startDate]").on("keydown",I),$("input[name=endDate]").on("keydown",I),$("input[name=startTime]").on("keyup",C),$("input[name=endTime]").on("keyup",C),$("input[name=empId]").on("keyup",function(){5==$(this).val().length&&D()})}function I(e){9===e.which&&27===e.which&&37===e.which&&39===e.which&&46===e.which||e.which>=65&&e.which<=90&&e.preventDefault()}function C(){var e=$(this).val();if(4===e.length){var t=e.slice(0,-2),n=e.slice(2);t=parseInt(t,10),n=parseInt(n,10),t>=25||n>=60?($(this).hasClass("bad")||$(this).addClass("bad"),N=!1):($(this).hasClass("bad")&&$(this).removeClass("bad"),N=!0)}return N}function M(e){var t=!1,n=!1;return 5==e.msgId.length&&(t=!0),$.each(e.info,function(e,t){return""===t.startDate||""===t.startTime||""===t.message?n=!1:void(n=!0)}),H=!!(t&&n&&N)}function S(){$.getJSON("./log.json",function(e){e=e.reverse();var t=[],n="";$.each(e,function(e,n){var a=n.msgId,i=n.timestamp;$.each(n.info,function(e,n){n.empId=a,n.timestamp=i,t.push(n)})}),$.each(t,function(e,t){t.startDate=t.startDate.slice(0,-4)+t.startDate.slice(8),(t.endDate||""!=t.endTime)&&(t.endDate=t.endDate.slice(0,-4)+t.endDate.slice(8)),n+="<tr>",n+="<td>"+t.timestamp+"</td>",n+="<td>"+t.empId+"</td>",n+="<td>"+t.startDate+"</td>",n+="<td>"+t.startTime+"</td>",n+="<td>"+t.endDate+"</td>",n+="<td>"+t.endTime+"</td>",n+="<td>"+t.message+"</td>",n+="</tr>"}),$("#return-table tbody").hide().html(n).fadeIn(300)})}function j(){$("input").val(""),$("textarea").val(""),$(O).each(function(e){w()}),H=!1,N=!1,h(),v()}$.ajaxSetup({cache:!1});var O=".form-duplicate-this",x=!1,N=!1,H=!1,z=$("form#msgForm");$(".dtpicker").datepicker(),$(".add-more-messages").on("click",b),$(".remove-last-message").on("click",w),$("#submit").click(i),$("#allClear").click(a),$("#appendMsg").click(o),$("input[name=empId]").on("focus",function(){$(this).hasClass("bad")&&$(this).removeClass("bad")}),$("textarea[name=message]").on("input",d);var A=moment(),J=moment.tz(A,"America/New_York").format("MM/DD/YY HH:mm"),W=moment.tz(A,"America/New_York").format("M/D/YYYY"),_=moment().add(1,"days"),E=moment.tz(_,"America/New_York").format("M/D/YYYY"),F;e();var P=function(){var e={};return $.getJSON("dates.json",function(t){e.regular=t.regular}),e}();setTimeout(function(){s()},2e3),$.fn.serializeObject=function(){var e=[];return $(this).each(function(t,n){var a={};$.each($(n).find("input"),function(e,t){var n=$(t).attr("name"),i=$(t).val();a[n]=i}),$.each($(n).find("textarea"),function(e,t){var n=$(t).attr("name"),i=$(t).val();a[n]=i}),e.push(a)}),e},k()})}(jQuery,window,document);