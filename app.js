!function($,e,t,n){"use strict";$(t).ready(function(){function e(){return I.isDST?(N="EST",console.log("We are currently on EST")):(N="EDT",console.log("We are currently on EDT")),N}function t(){$.getJSON("dates.json",function(e){$.each(e.regular,function(e,t){if(x===t)return M=!0}),$.each(e.early,function(e,t){if(O===t)return z=!0})})}function n(){var n=moment(),a=moment.tz(j,"America/New_York").format("MM/DD/YY HH:mm");e(),t();var i=a+" "+N;return i}function a(){$.getJSON("./results.json",function(e){var t="";$.each(e.info,function(e,n){n.startDate=n.startDate.slice(0,-4)+n.startDate.slice(8),n.endDate=n.endDate.slice(0,-4)+n.endDate.slice(8),(n.endDate||""!==n.endTime)&&(n.startTime=n.startTime.slice(0,-4)),t+="<p>"+n.startDate+" ",t+=n.startTime+" ",""!==n.endDate&&(t+="to "+n.endDate),""!==n.endTime&&(t+=" "+n.endTime+" "),t+=n.message+"</p>"}),$("#currentMessage").hide().html(t).fadeIn(300)})}function i(){var e=$("#msgForm"),t=e.valid();if(console.log("Form is valid? "+t),t){var a=$("input[name=empId]").val(),i={},s=n();i.timestamp=s,M?i.dateWarn="true":i.dateWarn="false",i.msgId=a,i.info=$(".form-duplicate-this").serializeObject(),$.each(i.info,function(e,t){t.startTime+=" "+N,""!==t.endTime&&(t.endTime+=" "+N)}),console.log(i);var c=JSON.stringify(i);console.log(c),$.ajax({url:"endpoint.php",data:{data:c},dataType:"json",type:"POST"}).done(function(e){console.log("success"),b(),o(),$(".half.two").append('<div class="good"><p>Your message has been sent!</p></div>'),r($(".good"))}).fail(function(e){console.error("fail")}).always(function(e){console.log("done")})}}function o(){setTimeout(function(){a(),Y()},2e3)}function r(e){setTimeout(function(){e&&e.fadeOut(2e3)},3e3),s(e)}function s(e){e.click(function(){$(this).stop().fadeOut(200)})}function c(){var e=!1,t=$("textarea");$.each(t,function(t,n){n.value.length<=0&&(e=!0)}),e?(m(),p(),k=!1):(d(),l(),k=!0)}function d(){v($(".add-more-messages"))}function m(){g($(".add-more-messages"))}function u(){v($(".remove-last-message"))}function f(){g($(".remove-last-message"))}function l(){v($("#submit"))}function p(){g($("#submit"))}function v(e){e.removeClass("disabled")}function g(e){e.hasClass("disabled")||e.addClass("disabled")}function h(){if(k){var e=$(y),t=0;e.first().off().clone().appendTo(e.parent()),t=$("textarea").length,$.each($(y),function(e,n){if(e==t-1){var a=$(n).find("textarea");a.val("").attr("placeholder","e.g. All Enterprise Systems and applications are operational."),a.on("input",c)}}),m(),k=!1,u()}}function D(){var e=$(y).length,t=$(y+":last");if(e>1)return t.remove(),e--,void(e<=1&&(f(),c()))}function T(e){var t=$(e.target),n=t.val(),a=$("#submit"),i=$(".form-button");5==n.length?(k=!0,a.prop("disabled",!1)):(k=!1,a.prop("disabled",!0))}function Y(){$.getJSON("./log.json",function(e){var t=[],n="";$.each(e,function(e,n){var a=n.msgId,i=n.timestamp;$.each(n.info,function(e,n){n.empId=a,n.timestamp=i,t.push(n)})}),$.each(t,function(e,t){t.startDate=t.startDate.slice(0,-4)+t.startDate.slice(8),t.endDate=t.endDate.slice(0,-4)+t.endDate.slice(8),n+="<tr>",n+="<td>"+t.timestamp+"</td>",n+="<td>"+t.empId+"</td>",n+="<td>"+t.startDate+"</td>",n+="<td>"+t.startTime+"</td>",n+="<td>"+t.endDate+"</td>",n+="<td>"+t.endTime+"</td>",n+="<td>"+t.message+"</td>",n+="</tr>"}),$("#return-table tbody").hide().html(n).fadeIn(300)})}function b(){$("input").val(""),$("textarea").val(""),$(y).each(function(e){D()})}$.ajaxSetup({cache:!1});var y=".form-duplicate-this",k=!1,S=$("form#msgForm");S.validate({rules:{empId:{required:!0,digits:!0}}}),$(".dtpicker").datepicker(),$(".add-more-messages").on("click",h),$(".remove-last-message").on("click",D),$("#submit").click(i),$("textarea[name=message]").on("input",c);var j=moment(),I=moment.tz(j,"America/New_York").format("MM/DD/YY HH:mm"),O=moment.tz(j,"America/New_York").format("M/D/YYYY"),w=moment().add(1,"days"),x=moment.tz(w,"America/New_York").format("M/D/YYYY"),N;e();var M,z;setTimeout(function(){o()},2e3),$.fn.serializeObject=function(){var e=[];return $(this).each(function(t,n){var a={};$.each($(n).find("input"),function(e,t){var n=$(t).attr("name"),i=$(t).val();a[n]=i}),$.each($(n).find("textarea"),function(e,t){var n=$(t).attr("name"),i=$(t).val();a[n]=i}),e.push(a)}),e},$("input[name=empId]").on("input",function(e){T(e)})})}(jQuery,window,document);